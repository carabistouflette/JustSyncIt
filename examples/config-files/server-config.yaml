# JustSyncIt Server Configuration
# This file contains configuration options for JustSyncIt server operations

# Server settings
server:
  # Network configuration
  host: "0.0.0.0"
  port: 8080
  max_connections: 100
  connection_timeout: 30000  # milliseconds
  idle_timeout: 600000       # milliseconds
  
  # SSL/TLS configuration
  ssl:
    enabled: false
    keystore_path: ""
    keystore_password: ""
    truststore_path: ""
    truststore_password: ""
    protocol: "TLSv1.3"
    cipher_suites:
      - "TLS_AES_256_GCM_SHA384"
      - "TLS_CHACHA20_POLY1305_SHA256"
      - "TLS_AES_128_GCM_SHA256"
  
  # Worker threads
  worker_threads: 50
  max_worker_threads: 200

# Authentication and authorization
auth:
  enabled: true
  type: "basic"  # Options: basic, ldap, oauth2
  
  # Basic authentication
  basic:
    users_file: "/etc/justsyncit/users.properties"
    session_timeout: 3600000  # milliseconds
    max_failed_attempts: 5
    lockout_duration: 900000  # milliseconds
  
  # LDAP authentication
  ldap:
    url: "ldap://ldap.company.com:389"
    base_dn: "ou=users,dc=company,dc=com"
    user_filter: "(uid={0})"
    bind_dn: "cn=admin,dc=company,dc=com"
    bind_password: ""
    connection_timeout: 5000  # milliseconds
    read_timeout: 10000       # milliseconds
  
  # OAuth2 authentication
  oauth2:
    provider: "google"  # Options: google, github, custom
    client_id: ""
    client_secret: ""
    redirect_uri: "http://localhost:8080/oauth2/callback"
    scopes: ["openid", "profile", "email"]
    user_info_url: ""
    token_url: ""
    auth_url: ""

# Storage configuration
storage:
  # Base directories
  base_directory: "/var/lib/justsyncit/storage"
  metadata_directory: "/var/lib/justsyncit/metadata"
  temp_directory: "/var/lib/justsyncit/temp"
  
  # Disk usage management
  max_disk_usage: 0.9  # 90% of disk
  cleanup_threshold: 0.8  # Start cleanup at 80%
  min_free_space_gb: 10
  
  # Chunk configuration
  chunk_size:
    default: 1048576  # 1MB
    min: 65536        # 64KB
    max: 16777216     # 16MB
  
  # Storage backend
  backend: "filesystem"  # Options: filesystem, s3, azure, gcs
  
  # Filesystem backend settings
  filesystem:
    path: "/var/lib/justsyncit/storage"
    create_directories: true
    directory_permissions: "750"
    file_permissions: "640"
  
  # S3 backend settings
  s3:
    endpoint: "s3.amazonaws.com"
    region: "us-east-1"
    bucket: "justsyncit-backups"
    access_key: ""
    secret_key: ""
    path_style_access: false
    multipart_threshold: 5368709120  # 5GB
    multipart_chunk_size: 10485760   # 10MB
  
  # Azure Blob Storage settings
  azure:
    account_name: ""
    account_key: ""
    container: "justsyncit-backups"
    endpoint: "https://account.blob.core.windows.net"
  
  # Google Cloud Storage settings
  gcs:
    project_id: ""
    bucket: "justsyncit-backups"
    credentials_file: "/etc/justsyncit/gcs-credentials.json"

# Database configuration
database:
  type: "sqlite"  # Options: sqlite, postgresql, mysql
  
  # SQLite configuration
  sqlite:
    path: "/var/lib/justsyncit/metadata/justsyncit.db"
    connection_pool_size: 20
    connection_timeout: 30000  # milliseconds
    wal_mode: true
    checkpoint_interval: 3600000  # milliseconds
    vacuum_interval: 86400000     # milliseconds
  
  # PostgreSQL configuration
  postgresql:
    host: "localhost"
    port: 5432
    database: "justsyncit"
    username: "justsyncit"
    password: ""
    connection_pool_size: 20
    connection_timeout: 30000  # milliseconds
    ssl_mode: "prefer"
  
  # MySQL configuration
  mysql:
    host: "localhost"
    port: 3306
    database: "justsyncit"
    username: "justsyncit"
    password: ""
    connection_pool_size: 20
    connection_timeout: 30000  # milliseconds
    ssl_mode: "disabled"

# Performance configuration
performance:
  # Thread pool settings
  thread_pool:
    core_size: 50
    max_size: 200
    queue_capacity: 1000
    keep_alive_time: 60000  # milliseconds
  
  # I/O settings
  io:
    buffer_size: 65536  # bytes
    direct_buffers: true
    async_io: true
  
  # Memory settings
  memory:
    max_heap_size: "2G"
    cache_size: "1G"
    off_heap_cache: false
  
  # Compression settings
  compression:
    enabled: true
    level: 6  # 1-9, where 9 is maximum compression
    algorithm: "lz4"  # Options: lz4, gzip, zstd
  
  # Deduplication settings
  deduplication:
    enabled: true
    algorithm: "blake3"  # Options: blake3, sha256
    cache_size: "512M"

# Network configuration
network:
  # Transport type
  transport_type: "tcp"  # Options: tcp, quic, both
  
  # TCP settings
  tcp:
    keep_alive: true
    keep_alive_time: 300    # seconds
    keep_alive_interval: 60 # seconds
    keep_alive_count: 3
    no_delay: true
    buffer_size: 131072     # bytes
    reuse_address: true
    send_buffer_size: 262144  # bytes
    receive_buffer_size: 262144  # bytes
  
  # QUIC settings
  quic:
    idle_timeout: 300000    # milliseconds
    max_idle_timeout: 900000 # milliseconds
    initial_max_data: 10485760  # bytes
    initial_max_stream_data_bidi_local: 1048576  # bytes
    initial_max_stream_data_bidi_remote: 1048576 # bytes
    initial_max_streams_bidi: 100
    max_udp_payload_size: 1200  # bytes

# Monitoring and metrics
monitoring:
  enabled: true
  metrics_port: 9090
  health_check_interval: 30000  # milliseconds
  stats_collection_interval: 60000  # milliseconds
  
  # Metrics export formats
  metrics_formats:
    - "prometheus"
    - "json"
  
  # Health checks
  health_checks:
    disk_space: true
    database_connection: true
    network_connectivity: true
    memory_usage: true

# Logging configuration
logging:
  level: "INFO"  # Options: TRACE, DEBUG, INFO, WARN, ERROR
  console:
    enabled: true
    format: "simple"  # Options: simple, detailed, json
  file:
    enabled: true
    path: "/var/log/justsyncit/server.log"
    max_size: "100MB"
    max_history: 30
    format: "detailed"
  syslog:
    enabled: false
    host: "localhost"
    port: 514
    facility: "daemon"
    format: "rfc3164"

# Maintenance and cleanup
maintenance:
  enabled: true
  
  # Garbage collection
  garbage_collection:
    enabled: true
    interval: 3600000  # milliseconds
    threshold: 0.7     # Run GC when 70% of chunks are unreferenced
    batch_size: 1000
  
  # Snapshot cleanup
  snapshot_cleanup:
    enabled: true
    interval: 86400000  # milliseconds (daily)
    default_retention_days: 90
    per_user_retention: {}
  
  # Database maintenance
  database_maintenance:
    enabled: true
    interval: 604800000  # milliseconds (weekly)
    vacuum: true
    analyze: true
    reindex: false
  
  # Disk space monitoring
  disk_space_check:
    enabled: true
    interval: 300000  # milliseconds (5 minutes)
    alert_threshold: 0.9  # Alert at 90% disk usage

# Rate limiting
rate_limiting:
  enabled: true
  requests_per_second: 100
  burst_size: 200
  bandwidth_limit_mbps: 1000
  per_user_limits: true
  user_limits: {}

# Backup policies
backup_policies:
  default:
    retention_days: 90
    compression_level: 6
    verify_integrity: true
    max_backup_size_gb: 1000
    max_snapshots_per_user: 1000
  
  # Per-user policies
  user_policies: {}

# Security policies
security:
  max_file_size_gb: 10
  allowed_file_types: ["*"]
  blocked_file_types: ["exe", "bat", "scr", "com", "pif"]
  virus_scan:
    enabled: false
    command: "/usr/bin/clamdscan"
    quarantine_directory: "/var/lib/justsyncit/quarantine"
  
  # Content filtering
  content_filtering:
    enabled: false
    max_filename_length: 255
    forbidden_patterns: []

# Notification configuration
notifications:
  enabled: true
  email:
    smtp:
      host: "smtp.company.com"
      port: 587
      username: "justsyncit@company.com"
      password: ""
      use_tls: true
      use_ssl: false
    from: "justsyncit@company.com"
    admin: "admin@company.com"
  
  # Notification events
  events:
    backup_completed: true
    backup_failed: true
    restore_completed: true
    restore_failed: true
    disk_space_warning: true
    system_error: true

# Cluster configuration (for high availability)
cluster:
  enabled: false
  node_id: "server1"
  discovery:
    type: "static"  # Options: static, dns, kubernetes
    nodes: ["server1:8080", "server2:8080", "server3:8080"]
    dns_domain: "justsyncit.company.com"
    kubernetes_namespace: "justsyncit"
    kubernetes_label_selector: "app=justsyncit"
  
  # Heartbeat and failure detection
  heartbeat:
    interval: 5000  # milliseconds
    timeout: 15000  # milliseconds
  failure_detection:
    timeout: 15000  # milliseconds
  
  # Consistency
  consistency_check:
    enabled: true
    interval: 300000  # milliseconds
  
  # Load balancing
  load_balancing:
    strategy: "round_robin"  # Options: round_robin, least_connections, hash

# Plugin configuration
plugins:
  enabled: true
  directory: "/etc/justsyncit/plugins"
  auto_load: true
  security_policy: "/etc/justsyncit/plugin-security.policy"
  
  # Available plugins
  available_plugins: []

# Development and debugging
debug:
  enabled: false
  profiling:
    enabled: false
    cpu_profiling: false
    memory_profiling: false
  heap_dump:
    on_oom: false
    path: "/var/log/justsyncit/heap-dumps"
  gc_logging:
    enabled: false
  request_tracing:
    enabled: false
  response_tracing:
    enabled: false
  sql_logging:
    enabled: false
  network_packet_logging:
    enabled: false

# Environment profiles
profiles:
  # Development profile
  development:
    server:
      host: "localhost"
      port: 8080
      ssl:
        enabled: false
    auth:
      enabled: false
    logging:
      level: "DEBUG"
      console:
        enabled: true
        format: "detailed"
      file:
        enabled: true
        path: "./logs/dev-server.log"
    debug:
      enabled: true
      profiling:
        enabled: true
    performance:
      memory:
        max_heap_size: "1G"
        cache_size: "256M"
  
  # Production profile
  production:
    server:
      ssl:
        enabled: true
    auth:
      enabled: true
      type: "ldap"
    logging:
      level: "INFO"
      console:
        enabled: false
      file:
        enabled: true
        path: "/var/log/justsyncit/server.log"
    monitoring:
      enabled: true
    security:
      virus_scan:
        enabled: true
    performance:
      memory:
        max_heap_size: "4G"
        cache_size: "2G"
  
  # Testing profile
  testing:
    server:
      host: "localhost"
      port: 0  # Random port
    auth:
      enabled: false
    storage:
      base_directory: "./test-storage"
      metadata_directory: "./test-metadata"
      temp_directory: "./test-temp"
    database:
      sqlite:
        path: "./test-metadata/test.db"
    logging:
      level: "WARN"
      console:
        enabled: false
      file:
        enabled: false
    maintenance:
      enabled: false